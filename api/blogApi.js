import{BASE_URL,myFunction}from"./baseApi.js";const loader=document.getElementById("loader"),tabs=document.getElementById("myTabContent");export const getAllBlogs=async(t=1,e=5)=>{try{loader.style.display="block",tabs&&(tabs.style.display="none");const n=await fetch(`${BASE_URL}/blogs?page=${t}&limit=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return loader.style.display="none",tabs&&(tabs.style.display="block"),await n.json()}catch(t){return console.error("Error fetching blogs:",t),null}};export const getBlogById=async t=>{try{const e=await fetch(`${BASE_URL}/blogs/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}catch(t){return console.error("Error fetching blog:",t),null}};export const addBlog=async t=>{try{loader.style.display="block",tabs&&(tabs.style.display="none");const e=await fetch(`${BASE_URL}/blogs`,{method:"POST",body:t,credentials:"include"});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return loader.style.display="none",tabs&&(tabs.style.display="block"),await e.json()}catch(t){return console.error("Error adding blog:",t),null}};export const updateBlogById=async(t,e)=>{try{loader.style.display="block",tabs&&(tabs.style.display="none");const n=await fetch(`${BASE_URL}/blogs/${t}`,{method:"PUT",body:e,credentials:"include"});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return loader.style.display="none",tabs&&(tabs.style.display="block"),await n.json()}catch(t){return console.error("Error updating blog:",t),null}};export const deleteBlogById=async t=>{try{loader.style.display="block",tabs&&(tabs.style.display="none");const e=await fetch(`${BASE_URL}/blogs/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return loader.style.display="none",tabs&&(tabs.style.display="block"),await e.json()}catch(t){return console.error("Error deleting blog:",t),null}};const page=1,limit=8;let currentPage=1,totalPages=1;const fetchData=async(t,e,n=1)=>{const o=document.getElementById(e);o.innerHTML="",console.log(t,e,n);try{if("blogs"===t){const t=await getAllBlogs(n,8);populateBlogsTable(o,t),updatePaginationControls("blog-pagination-container",t.currentPage,t.totalPages)}}catch(e){console.error(`Error fetching ${t}:`,e)}};let editingBlogId=null;const editBlog=t=>{console.log("Edit Blog Functionality"),editingBlogId=t,getBlogById(t).then((t=>{populateEditBlogForm(t)}))},deleteBlog=t=>{console.log("delete Blog Functionality"),editingBlogId=t,getBlogById(t).then((async t=>{await deleteBlogById(t._id),fetchData("blogs","blogs-container"),document.getElementById("imagePreview").style="display: none; max-width: 100%; height: auto"}))},updatePaginationControls=(t,e,n)=>{const o=document.getElementById(t);if(o.innerHTML="",e>1){const t=document.createElement("button");t.textContent="<",t.classList.add("btn","btn-secondary","btn-sm","me-2"),t.addEventListener("click",(()=>{fetchData("blogs","blogs-container",e-1)})),o.appendChild(t)}const a=document.createElement("span");if(a.textContent=`Page ${e} of ${n}`,a.classList.add("pagination-info","ms-3"),o.appendChild(a),e<n){const t=document.createElement("button");t.textContent=">",t.classList.add("btn","btn-secondary","btn-sm","ms-2"),t.addEventListener("click",(()=>{fetchData("blogs","blogs-container",e+1)})),o.appendChild(t)}};export const populateBlogsTable=(t,e)=>{const{currentPage:n,totalPages:o}=e;if(console.log(n,o),currentPage=n,totalPages=o,updatePaginationControls("blog-pagination-container",n,o),t.innerHTML="",!e||!e.data||0===e.data.length)return void(t.innerHTML="<tr><td colspan='4'>No blogs available</td></tr>");e.data.forEach((e=>{const n=document.createElement("tr");n.innerHTML=`\n      <td>${e.title.slice(0,50)}</td>\n      <td>${e.content[0].slice(0,50)}${e.content[0].length>50?"...":""}</td>\n      <td>${e.author}</td>\n      <td>\n        <button class="btn btn-warning btn-sm edit-btn" data-id="${e._id}">Edit</button>\n        <button class="btn btn-danger btn-sm delete-btn" data-id="${e._id}">Delete</button>\n      </td>\n    `,t.appendChild(n)}));t.querySelectorAll(".edit-btn").forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.dataset.id;editBlog(e)}))}));t.querySelectorAll(".delete-btn").forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.dataset.id;deleteBlog(e)}))}))};export const populateEditBlogForm=t=>{document.getElementById("blogTitle").value=t.title,document.getElementById("blogAuthor").value=t.author;const e=document.getElementById("imagePreview");t.media?(e.src=t.media,e.style.display="block"):(e.src="",e.style.display="none");const n=document.getElementById("contentContainer");n.innerHTML="",t.content.forEach(((t,e)=>{const o=document.createElement("div");o.classList.add("content-item","mb-2"),o.innerHTML=`\n      <textarea\n        class="form-control blogContent"\n        rows="3"\n        placeholder="Edit paragraph ${e+1}"\n      >${t}</textarea>\n      <button\n        type="button"\n        class="btn btn-danger removeContent mt-2"\n      >\n        - Remove\n      </button>\n    `,n.appendChild(o);o.querySelector(".removeContent").addEventListener("click",(()=>{n.removeChild(o)}))})),document.getElementById("blogImage").value=""};export const handleBlogFormSubmission=async(t,e)=>{t.preventDefault();const n=document.getElementById("blogTitle").value,o=document.getElementById("blogAuthor").value,a=document.querySelectorAll(".blogContent"),l=Array.from(a).map((t=>t.value)),r=document.getElementById("blogImage").files[0];console.log(n,o,l);const s=new FormData;s.append("data",JSON.stringify({title:n,author:o,content:l})),r&&s.append("photos",r);try{e?await updateBlogById(e,s):await addBlog(s),document.getElementById("blogTitle").value="",document.getElementById("blogAuthor").value="",document.querySelectorAll(".blogContent").forEach((t=>t.remove()));document.getElementById("contentContainer").innerHTML='\n      <div class="content-item mb-2">\n        <textarea\n          class="form-control blogContent"\n          rows="3"\n          placeholder="Add a paragraph"\n        ></textarea>\n      </div>\n    ',document.getElementById("blogImage").value="",document.getElementById("imagePreview").style="display: none; max-width: 100%; height: auto",myFunction("Blog Submitted Successfully"),fetchData("blogs","blogs-container")}catch(t){console.error("Error handling form submission:",t)}};document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("blogImage").addEventListener("change",(t=>{const e=t.target.files[0],n=document.getElementById("imagePreview");if(e){const t=new FileReader;t.onload=()=>{n.src=t.result,n.style.display="block"},t.readAsDataURL(e)}else n.src="",n.style.display="none"})),document.getElementById("blogForm").addEventListener("submit",(t=>{handleBlogFormSubmission(t,editingBlogId)})),document.getElementById("addContent").addEventListener("click",(()=>{const t=document.getElementById("contentContainer"),e=document.createElement("div");e.classList.add("content-item","mb-2"),e.innerHTML='\n      <textarea\n        class="form-control blogContent"\n        rows="3"\n        placeholder="Add another paragraph"\n      ></textarea>\n      <button\n        type="button"\n        class="btn btn-danger removeContent mt-2"\n      >\n        - Remove\n      </button>\n    ',t.appendChild(e),e.querySelector(".removeContent").addEventListener("click",(()=>{t.removeChild(e)}))})),document.querySelectorAll(".removeContent").forEach((t=>{t.addEventListener("click",(t=>{const e=t.target.closest(".content-item");e.parentElement.removeChild(e)}))})),fetchData("blogs","blogs-container",currentPage)}));